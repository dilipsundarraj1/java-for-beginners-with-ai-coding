<?xml version="1.0" encoding="UTF-8"?>
<svg width="1300" height="900" viewBox="0 0 1300 900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: 700 24px Arial, Helvetica, sans-serif; fill: #111; }
      .subtitle { font: 600 14px Arial, Helvetica, sans-serif; fill: #333; }
      .label { font: 600 14px Arial, Helvetica, sans-serif; fill: #222; }
      .small { font: 500 12px Arial, Helvetica, sans-serif; fill: #444; }
      .code { font: 500 12px Menlo, Consolas, "Courier New", monospace; fill: #333; }
      .stack { fill: #eef6ff; stroke: #7fb3ff; }
      .heap { fill: #eefaf2; stroke: #78d39b; }
      .meta { fill: #fff3e6; stroke: #f3b16a; }
      .native { fill: #f0f0f0; stroke: #cfcfcf; }
      .panel { fill: #ffffff; stroke: #e5e7eb; rx: 14; }
      .frame { fill: #ffffff; stroke: #4f83ff; rx: 8; }
      .obj { fill: #ffffff; stroke: #2db070; rx: 10; }
      .classbox { fill: #ffffff; stroke: #e1953b; rx: 10; }
      .pool { fill: #f6fff8; stroke: #9bd8b0; rx: 10; }
      .arrow { stroke: #555; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .dashed { stroke-dasharray: 5 5; }
      .root { fill: #e11d48; }
      .legend { fill: #f8fafc; stroke: #e5e7eb; rx: 10; }
      .hint { fill: #6b7280; font: 500 11px Arial, Helvetica, sans-serif; }
    </style>
    <marker id="arrowhead" markerWidth="8" markerHeight="8" refX="8" refY="4" orient="auto">
      <polygon points="0,0 8,4 0,8" fill="#555"/>
    </marker>
  </defs>

  <!-- Header -->
  <text x="650" y="34" text-anchor="middle" class="title">Java Memory Overview: Stack, Heap, Metaspace (Method Area) &amp; GC Roots</text>
  <text x="650" y="60" text-anchor="middle" class="subtitle">
    Variables on the stack hold references to objects on the heap. Class metadata lives in Metaspace. Unreachable objects are reclaimed by GC.
  </text>

  <!-- Legend -->
  <g>
    <rect x="300" y="76" width="700" height="58" class="legend"/>
    <rect x="320" y="92" width="16" height="12" class="stack" rx="3"/><text x="342" y="102" class="small">Stack (per thread: frames, locals, references)</text>
    <rect x="580" y="92" width="16" height="12" class="heap" rx="3"/><text x="602" y="102" class="small">Heap (objects, arrays, string intern pool)</text>
    <rect x="820" y="92" width="16" height="12" class="meta" rx="3"/><text x="842" y="102" class="small">Metaspace (class metadata, constant pools)</text>
  </g>

  <!-- Left: Thread stacks -->
  <g transform="translate(30,150)">
    <rect width="340" height="680" class="panel"/>
    <text x="16" y="26" class="label">Thread Stacks</text>
    <text x="16" y="46" class="small">Each thread has its own stack of frames; frames store local variables and references.</text>

    <!-- Thread 1 -->
    <text x="16" y="76" class="small">Thread-1 stack</text>
    <rect x="16" y="86" width="308" height="220" class="stack" rx="12"/>
      <!-- Frames (top is last called) -->
      <rect x="30" y="100" width="280" height="48" class="frame"/>
      <text x="40" y="128" class="code">main(String[] args)</text>
      <text x="40" y="146" class="small">m1: ref to Movie#1</text>

      <rect x="30" y="154" width="280" height="48" class="frame"/>
      <text x="40" y="182" class="code">browse()</text>
      <text x="40" y="200" class="small">cart: ref to Cart#7</text>

      <rect x="30" y="208" width="280" height="48" class="frame"/>
      <text x="40" y="236" class="code">checkout()</text>
      <text x="40" y="254" class="small">pay: ref to CreditCard#3</text>

    <!-- GC root markers on stack -->
    <circle cx="312" cy="124" r="5" class="root"/>
    <circle cx="312" cy="208" r="5" class="root"/>
    <circle cx="312" cy="260" r="5" class="root"/>

    <!-- Thread 2 -->
    <text x="16" y="330" class="small">Thread-2 stack</text>
    <rect x="16" y="340" width="308" height="220" class="stack" rx="12"/>
      <rect x="30" y="354" width="280" height="48" class="frame"/>
      <text x="40" y="382" class="code">http-worker()</text>
      <text x="40" y="400" class="small">buf: ref to byte[]#12</text>

      <rect x="30" y="408" width="280" height="48" class="frame"/>
      <text x="40" y="436" class="code">parse()</text>
      <text x="40" y="454" class="small">tmp: null</text>

    <circle cx="312" cy="382" r="5" class="root"/>
  </g>

  <!-- Center: Heap -->
  <g transform="translate(400,150)">
    <rect width="500" height="680" class="panel"/>
    <text x="16" y="26" class="label">Heap</text>
    <text x="16" y="46" class="small">All objects live here; shared by all threads; managed by the garbage collector.</text>

    <!-- Objects -->
    <rect x="30" y="80" width="210" height="110" class="obj"/>
    <text x="135" y="102" text-anchor="middle" class="label">Movie#1</text>
    <text x="40" y="124" class="small">title: "The Matrix"</text>
    <text x="40" y="142" class="small">rating: 9.0</text>

    <rect x="260" y="80" width="210" height="110" class="obj"/>
    <text x="365" y="102" text-anchor="middle" class="label">Cart#7</text>
    <text x="270" y="124" class="small">items: 2</text>
    <text x="270" y="142" class="small">total: 25.00</text>

    <rect x="30" y="210" width="210" height="90" class="obj"/>
    <text x="135" y="232" text-anchor="middle" class="label">CreditCard#3</text>
    <text x="40" y="254" class="small">masked: ****-1234</text>

    <rect x="260" y="210" width="210" height="90" class="obj"/>
    <text x="365" y="232" text-anchor="middle" class="label">byte[]#12</text>
    <text x="270" y="254" class="small">len: 8192</text>

    <!-- String pool box -->
    <rect x="30" y="320" width="440" height="120" class="pool"/>
    <text x="40" y="340" class="small">String Intern Pool (on heap)</text>
    <text x="40" y="360" class="code">"The Matrix"</text>
    <text x="160" y="360" class="code">"Harry Potter"</text>
    <text x="280" y="360" class="code">"IMAX"</text>
    <text x="40" y="380" class="hint">Strings created via intern() or literals may share instances here.</text>

    <!-- Unreachable object (to be GC'ed) -->
    <rect x="180" y="480" width="170" height="90" class="obj" style="stroke-dasharray:6 6"/>
    <text x="265" y="504" text-anchor="middle" class="label">Seat#42</text>
    <text x="190" y="526" class="small">now unreachable</text>
    <text x="190" y="544" class="hint">eligible for GC</text>
  </g>

  <!-- Right: Metaspace / Method Area -->
  <g transform="translate(930,150)">
    <rect width="340" height="680" class="panel"/>
    <text x="16" y="26" class="label">Metaspace (Method Area)</text>
    <text x="16" y="46" class="small">Holds class metadata, method tables, and constant pools (HotSpot).</text>

    <rect x="16" y="76" width="308" height="120" class="meta" rx="12"/>
      <rect x="28" y="90" width="284" height="40" class="classbox"/>
      <text x="40" y="116" class="small">Class: Movie</text>
      <text x="200" y="116" class="small">methods: 12</text>

      <rect x="28" y="136" width="284" height="40" class="classbox"/>
      <text x="40" y="162" class="small">Class: String</text>
      <text x="200" y="162" class="small">methods: 60+</text>

    <!-- Static ref note -->
    <rect x="16" y="210" width="308" height="90" class="meta" rx="12"/>
    <text x="24" y="232" class="small">Static fields are stored in heap inside Class objects,</text>
    <text x="24" y="250" class="small">but the class metadata is here in Metaspace.</text>

    <!-- JNI / Native -->
    <rect x="16" y="320" width="308" height="100" class="native" rx="12"/>
    <text x="24" y="340" class="small">Native Method Stack</text>
    <text x="24" y="358" class="hint">Used by JNI/native calls</text>

    <!-- GC Roots box -->
    <rect x="16" y="440" width="308" height="130" class="meta" rx="12"/>
    <text x="24" y="462" class="small">GC Roots</text>
    <text x="24" y="480" class="small">• Active thread stacks</text>
    <text x="24" y="498" class="small">• Static references via loaded classes</text>
    <text x="24" y="516" class="small">• JNI references</text>
  </g>

  <!-- Reference arrows from stacks to heap -->
  <!-- From Thread-1 main m1 -> Movie#1 -->
  <path d="M370,274 C420,274 430,130 430,130" class="arrow"/>
  <!-- From Thread-1 browse cart -> Cart#7 -->
  <path d="M370,224 C410,224 520,130 520,130" class="arrow"/>
  <!-- From Thread-1 checkout pay -> CreditCard#3 -->
  <path d="M370,280 C420,280 440,250 430,260" class="arrow"/>
  <!-- From Thread-2 buf -> byte[]#12 -->
  <path d="M370,466 C430,466 640,260 640,260" class="arrow"/>

  <!-- Static reference arrow (metaspace note) to heap -->
  <path d="M930,298 C880,298 820,200 670,200" class="arrow dashed"/>

  <!-- Caption notes -->
  <text x="650" y="860" text-anchor="middle" class="hint">
    Notes: 1) References are followed from GC roots to find live objects. 2) Objects not reachable become eligible for garbage collection.
  </text>
</svg>
